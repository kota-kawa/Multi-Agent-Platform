:root{
  --bg:#0f1115;
  --panel:#161a22;
  --panel-2:#1b2130;
  --border:#2a3242;
  --text:#e6e9ef;
  --muted:#b8c1cc;
  --primary:#177de5;
  --primary-2:#0f62c7;
  --accent:#5bd1ff;
  --good:#38c172;
  --warn:#ffb020;
  --bad:#ef5350;
  --shadow:0 10px 25px rgba(0,0,0,.35);
  --radius:14px;
  --sidebar-width:495px;
  --scrollbar-track:rgba(10,14,24,.82);
  --scrollbar-thumb:rgba(68,108,176,.55);
  --scrollbar-thumb-hover:rgba(91,209,255,.55);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple Color Emoji','Segoe UI Emoji',sans-serif;
  line-height:1.6;
}

.app{min-height:100svh; display:flex; flex-direction:column}

.content-header{
  display:flex; flex-direction:column; gap:6px;
  margin-bottom:20px;
}
.content-title{margin:0; font-size:26px; font-weight:700}
.content-subtitle{margin:0; font-size:14px; color:var(--muted)}

/* layout */
.layout{
  display:flex;
  min-height:0;
  min-width:0;
  flex:1;
  position:relative;
}

/* sidebar */
.sidebar{
  width:var(--sidebar-width);
  flex:0 0 var(--sidebar-width);
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:28px 20px;
  display:flex;
  flex-direction:column;
  gap:20px;
  min-height:0;
  min-width:0;
  position:sticky;
  top:0;
  align-self:stretch;
  height:100vh;
  height:100svh;
  overflow-y:auto;
  overflow-x:hidden;
  transition:width .45s ease, padding .45s ease, transform .45s ease, opacity .3s ease, border-color .45s ease;
}
.layout.sidebar-collapsed .sidebar{
  width:0;
  flex-basis:0;
  padding-left:0;
  padding-right:0;
  transform:translateX(-32px);
  opacity:0;
  border-right-color:transparent;
  pointer-events:none;
  overflow:hidden;
}
.layout.sidebar-collapsed .sidebar-chat,
.layout.sidebar-collapsed .sidebar-nav,
.layout.sidebar-collapsed .sidebar-title{
  opacity:0;
  transition:opacity .2s ease;
}
.layout .sidebar-chat,
.layout .sidebar-nav,
.layout .sidebar-title{
  transition:opacity .3s ease .15s;
}

.sidebar-toggle{
  position:absolute;
  top:var(--sidebar-toggle-top, 50%);
  left:calc(var(--sidebar-width) - 16px);
  transform:translate(-50%, -50%);
  width:44px;
  height:92px;
  border-radius:999px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, rgba(34,43,62,.96), rgba(16,22,34,.94));
  color:var(--muted);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:var(--shadow);
  transition:background .25s ease, color .25s ease, box-shadow .25s ease, left .45s ease;
  z-index:30;
}
.sidebar-toggle:hover{
  color:#fff;
  box-shadow:0 18px 32px rgba(10,18,32,.6);
  background:linear-gradient(180deg, rgba(44,56,80,.96), rgba(18,26,40,.94));
}
.sidebar-toggle:active{
  box-shadow:0 12px 24px rgba(8,14,24,.65);
}
.sidebar-toggle:focus-visible{
  outline:2px solid rgba(91,209,255,.7);
  outline-offset:3px;
}
.sidebar-toggle-icon{
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform .45s ease;
}
.sidebar-toggle-icon svg{width:18px; height:18px; display:block;}
.layout.sidebar-collapsed .sidebar-toggle{
  left:24px;
}
.layout.sidebar-collapsed .sidebar-toggle-icon{
  transform:rotate(180deg);
}
.sidebar-title{
  margin:0; font-size:13px; font-weight:600; color:var(--muted);
  letter-spacing:.04em;
}
.sidebar-nav{
  display:flex;
  gap:12px;
  align-items:stretch;
}
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}
.sidebar-chat{
  background:linear-gradient(180deg, rgba(32,41,62,.92), rgba(19,25,36,.94));
  border:1px solid rgba(91,209,255,.18);
  border-radius:18px;
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:18px;
  box-shadow:var(--shadow);
  flex:1;
  min-height:0;
  max-height:100%;
  overflow:hidden;
}
.sidebar-chat-header{display:flex; flex-direction:column; gap:8px}
.sidebar-chat-title{
  margin:0;
  font-size:15px;
  font-weight:700;
  letter-spacing:.05em;
  display:flex;
  align-items:center;
  gap:10px;
}
.sidebar-chat-icon{
  width:36px;
  height:36px;
  border-radius:12px;
  background:rgba(91,209,255,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.3);
}
.sidebar-chat-icon svg{width:20px; height:20px}
.sidebar-chat-desc{margin:0; font-size:12px; color:var(--muted); line-height:1.6}
.sidebar-chat-log{
  background:rgba(8,12,22,.88);
  border:1px solid rgba(91,209,255,.14);
  border-radius:14px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
  min-height:0;
  max-height:100%;
  flex:1;
  overflow-y:auto;
  overflow-x:hidden;
}
.sidebar-chat-form{
  display:flex;
  gap:14px;
  align-items:stretch;
  background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(91,209,255,.08));
  border:1px solid rgba(91,209,255,.22);
  border-radius:16px;
  padding:16px;
  box-shadow:0 14px 34px rgba(7,16,32,.45);
}
.sidebar-chat-action-column{
  display:flex;
  flex-direction:column;
  gap:14px;
  align-items:center;
  justify-content:space-between;
  min-width:0;
  align-self:stretch;
}
.sidebar-chat-utilities{
  display:flex;
  gap:10px;
  justify-content:center;
}
.sidebar-chat-utilities[hidden]{
  display:none;
}
.sidebar-chat-control{
  width:44px;
  height:44px;
  border-radius:14px;
  border:1px solid rgba(91,209,255,.25);
  background:linear-gradient(160deg, rgba(47,123,255,.18), rgba(26,91,255,.12));
  color:var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
  padding:0;
}
.sidebar-chat-control:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
}
.sidebar-chat-control:not(:disabled):hover{
  transform:translateY(-1px);
  box-shadow:0 18px 30px rgba(16,44,102,.4);
  border-color:rgba(91,209,255,.55);
  background:linear-gradient(160deg, rgba(63,139,255,.32), rgba(26,91,255,.18));
}
.sidebar-chat-control:focus-visible{
  outline:2px solid rgba(91,209,255,.75);
  outline-offset:3px;
}
.sidebar-chat-control-icon svg{
  width:18px;
  height:18px;
  display:block;
}
.sidebar-chat-input{
  flex:1;
  width:100%;
  min-height:92px;
  border-radius:16px;
  border:1px solid rgba(86,132,205,.42);
  background:linear-gradient(180deg, #f6f9ff 0%, #e4edff 100%);
  color:#0f1f38;
  padding:16px 18px;
  font-size:14px;
  font-family:inherit;
  line-height:1.65;
  resize:vertical;
  box-shadow:0 10px 28px rgba(15,34,68,.2), inset 0 0 0 1px rgba(255,255,255,.7);
  transition:border-color .18s ease, box-shadow .18s ease;
  caret-color:var(--accent);
  overflow-y:auto;
  overflow-x:hidden;
}
.sidebar-chat-input:focus{
  outline:none;
  border-color:rgba(74,134,255,.78);
  box-shadow:0 16px 36px rgba(18,40,78,.28), 0 0 0 2px rgba(91,209,255,.32), inset 0 0 0 1px rgba(255,255,255,.9);
}
.sidebar-chat-input::placeholder{
  color:rgba(60,92,148,.8);
}
.sidebar-chat-send{
  flex-shrink:0;
  width:48px;
  height:48px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg, #2f7bff, #1a5bff);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  cursor:pointer;
  font-family:inherit;
  box-shadow:0 18px 32px rgba(16,44,102,.45);
  transition:transform .18s ease, box-shadow .18s ease, background .18s ease;
  -webkit-appearance:none;
  appearance:none;
}
.sidebar-chat-send:hover{
  transform:translateY(-1px);
  box-shadow:0 24px 40px rgba(16,44,102,.5);
}
.sidebar-chat-send:active{
  transform:translateY(0);
  box-shadow:0 12px 24px rgba(16,44,102,.45);
}
.sidebar-chat-send:focus-visible{
  outline:2px solid rgba(91,209,255,.75);
  outline-offset:3px;
}
.sidebar-chat-send-icon svg{
  width:18px;
  height:18px;
  display:block;
}
.sidebar-chat-log .msg{
  max-width:100%;
  font-size:13px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(33,45,68,.78);
  border:none;
  align-self:stretch;
}
.sidebar-chat-log .msg.compact .msg-time{font-size:11px}
.sidebar-chat-log .msg.user{
  background:rgba(47,89,164,.75);
  border:1px solid rgba(91,209,255,.35);
}
.sidebar-chat-log .msg.system,
.sidebar-chat-log .msg.assistant{
  background:rgba(32,44,68,.78);
  border:1px solid rgba(91,209,255,.2);
}
.sidebar-chat-log .msg.pending{opacity:.75; font-style:italic;}
.nav-btn{
  display:flex; flex-direction:column; align-items:center; gap:4px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, #1a2130, #141a26);
  color:var(--muted);
  padding:10px 6px; border-radius:12px; cursor:pointer;
  width:100%;
  transition:.15s transform ease, .15s box-shadow ease, .15s color ease, .15s border-color ease;
}
.nav-btn svg{opacity:.9}
.nav-btn span{font-size:11px; letter-spacing:.04em}
.nav-btn:hover{transform:translateY(-1px); box-shadow:var(--shadow); color:#fff; border-color:#3a4660}
.nav-btn.active{color:#fff; border-color:#4a86ff; box-shadow:0 0 0 1px #4a86ff inset}

.sidebar-nav .nav-btn{
  flex:1;
  width:auto;
  min-width:0;
}
.sidebar-nav .nav-btn svg{
  width:18px;
  height:18px;
}

/* main content */
.content{
  flex:1;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:24px;
  min-height:0;
  overflow:hidden;
  background:
    radial-gradient(1200px 700px at 30% -80%, rgba(61,125,255,.18), transparent 60%),
    radial-gradient(1200px 700px at 90% -80%, rgba(40,201,255,.14), transparent 60%);
}

#view-general.view.active{display:flex; flex-direction:column; flex:1; min-height:0}
.view{display:none}
.view.active{display:block; overflow:auto; flex:1; min-height:0}
#view-browser.view.active{
  display:flex;
  flex-direction:column;
  flex:1;
  min-height:0;
  overflow:hidden;
}
.content-header{flex-shrink:0}
.general-view{
  background:var(--panel-2);
  border-radius:18px;
  padding:28px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:16px;
  flex:1;
  min-height:0;
}
.general-view h2{
  margin:0;
  font-size:24px;
  font-weight:700;
}
.general-view p{
  margin:0;
  color:var(--muted);
  font-size:15px;
  line-height:1.8;
}
.general-view__default{display:flex; flex-direction:column; gap:16px}
.general-view__status{
  margin:0;
  font-size:14px;
  color:var(--muted);
  line-height:1.7;
}
.general-view__proxy{
  display:none;
  flex-direction:column;
  gap:20px;
  margin-top:12px;
  flex:1;
  min-height:0;
}
.general-view--has-proxy .general-view__proxy{display:flex}
.general-view--has-proxy .general-view__default{display:none}
.view.general-proxy-active{display:block; overflow:auto; flex:1; min-height:0}
#view-browser.view.general-proxy-active{display:flex; flex-direction:column; flex:1; min-height:0; overflow:hidden}

/* generic buttons */
.btn{
  appearance:none; border:none; cursor:pointer;
  padding:10px 14px; border-radius:10px;
  background:#2a3446; color:#fff; box-shadow:var(--shadow);
}
.btn.subtle{background:#242b3a; box-shadow:none; border:1px solid var(--border)}
.btn.ghost{background:transparent; border:1px solid #6e84a8}
.btn.primary{background:linear-gradient(180deg, var(--primary), var(--primary-2)); font-weight:700}
.btn.large{font-size:18px; padding:12px 20px}

/* browser */
.no-vnc-surface{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  flex:1;
  min-height:0;
  height:100%;
  overflow:hidden;
  position:relative;
}

.stage{
  width:100%;
  flex:1 1 auto;
  min-width:0;
  min-height:0;
  height:100%;
  background:#05060a;
  border-radius:0;
  border:0;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
  color:#c1cad7;
}

.stage iframe{
  display:block;
  width:100%;
  height:100%;
  border:0;
  border-radius:0;
  background:#000;
}

.stage-fallback{
  margin:0;
  padding:24px;
  color:var(--muted);
  font-size:14px;
  text-align:center;
}

.browser-toolbar{
  position:absolute;
  top:16px;
  right:16px;
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:999px;
  background:rgba(9,14,24,.72);
  backdrop-filter:blur(8px);
  box-shadow:0 8px 20px rgba(0,0,0,.45);
  z-index:5;
}

/* IoT dashboard */
.section-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin:8px 0 14px;
  gap:18px;
}
.section-header h2, .section-header h3{margin:0}
.section-title{
  display:flex;
  align-items:center;
  gap:16px;
  flex-wrap:wrap;
}
.section-title > div{display:flex; flex-direction:column; gap:4px}
.section-icon{
  width:44px;
  height:44px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(91,209,255,.14);
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.24);
}
.section-icon svg{width:24px; height:24px}
.section-caption{margin:4px 0 0; font-size:13px; color:var(--muted)}
.section-actions{display:flex; gap:10px; flex-wrap:wrap}
.badge{
  background:#263248; border:1px solid #3a4b6b; color:#cde3ff;
  padding:4px 8px; border-radius:999px; font-size:12px
}

.iot-notice{
  margin:16px 0;
  padding:14px 16px;
  border-radius:14px;
  border:1px solid rgba(91,209,255,.28);
  background:rgba(16,26,44,.85);
  color:#d3e8ff;
  box-shadow:0 0 0 1px rgba(91,209,255,.12) inset;
  transition:.2s ease;
}
.iot-notice[data-kind="error"]{
  border-color:rgba(239,83,80,.45);
  background:rgba(50,12,18,.85);
  color:#ffd6d3;
  box-shadow:0 0 0 1px rgba(239,83,80,.22) inset;
}
.iot-notice[data-kind="success"]{
  border-color:rgba(56,193,114,.38);
  background:rgba(20,46,34,.85);
  color:#c9f5db;
  box-shadow:0 0 0 1px rgba(56,193,114,.2) inset;
}

.device-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(240px, 1fr));
  gap:18px;
  margin-bottom:20px;
  align-items:stretch;
  justify-content:flex-start;
}

.device-card{
  position:relative;
  overflow:hidden;
  padding:18px;
  border-radius:18px;
  background:linear-gradient(160deg, rgba(26,34,54,.94), rgba(9,14,24,.92));
  border:1px solid rgba(91,209,255,.18);
  box-shadow:0 14px 30px rgba(5,9,18,.36);
  display:flex;
  flex-direction:column;
  gap:16px;
  min-height:0;
  width:100%;
  max-width:340px;
  justify-self:flex-start;
  transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease;
  backdrop-filter:blur(6px);
}

.device-card:hover{
  transform:translateY(-4px);
  border-color:rgba(91,209,255,.32);
  box-shadow:0 20px 36px rgba(5,10,22,.45);
}

.device-card::before{
  content:"";
  position:absolute;
  inset:-70px auto auto -40px;
  width:140px;
  height:140px;
  background:radial-gradient(circle at center, rgba(91,209,255,.18), transparent 70%);
  pointer-events:none;
  opacity:.8;
}

.device-card::after{
  content:"";
  position:absolute;
  inset:auto -60px -70px auto;
  width:150px;
  height:150px;
  background:radial-gradient(circle at center, rgba(20,34,58,.48), transparent 64%);
  pointer-events:none;
}

.device-card-header{
  position:relative;
  z-index:1;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  padding-bottom:12px;
  border-bottom:1px solid rgba(91,209,255,.12);
}

.device-summary{
  display:flex;
  align-items:center;
  gap:12px;
  min-width:0;
}

.device-icon{
  width:44px;
  height:44px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg, rgba(91,209,255,.24), rgba(31,100,188,.22));
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.32), 0 6px 14px rgba(10,20,34,.55);
}

.device-icon svg{width:18px; height:18px}

.device-meta{display:flex; flex-direction:column; gap:4px; min-width:0}
.device-name{
  margin:0;
  font-size:16px;
  font-weight:600;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.device-id{
  margin:0;
  font-size:12px;
  color:rgba(200,214,235,.66);
  letter-spacing:.06em;
}

.device-actions{display:flex; gap:8px; flex-wrap:wrap}

.icon-btn{
  width:28px;
  height:28px;
  border-radius:9px;
  border:1px solid rgba(115,138,178,.34);
  background:rgba(10,16,28,.65);
  color:#d6e4ff;
  display:grid;
  place-items:center;
  cursor:pointer;
  font-size:14px;
  line-height:1;
  transition:transform .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
}

.icon-btn:hover{
  color:#fff;
  border-color:rgba(91,209,255,.55);
  background:rgba(28,46,74,.85);
  transform:translateY(-1px);
}

.icon-btn:focus{outline:none; box-shadow:0 0 0 2px rgba(91,209,255,.28);}

.device-body{
  position:relative;
  z-index:1;
  display:grid;
  gap:12px;
}

.device-stats{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(120px, 1fr));
  gap:8px;
}

.device-stat{
  min-width:0;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(12,20,34,.78);
  border:1px solid rgba(91,209,255,.18);
  display:flex;
  flex-direction:column;
  gap:6px;
  box-shadow:0 10px 20px rgba(6,12,24,.32);
}

.device-stat__label{font-size:10px; letter-spacing:.12em; color:rgba(200,214,235,.7); text-transform:uppercase}
.device-stat__value{font-size:14px; font-weight:600; color:#f1f7ff}

.device-section{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px 14px;
  background:rgba(12,20,34,.78);
  border:1px solid rgba(91,209,255,.18);
  border-radius:12px;
  box-shadow:0 10px 20px rgba(6,12,24,.32);
}
.device-section__label{
  font-size:11px;
  letter-spacing:.16em;
  color:rgba(200,214,235,.68);
  text-transform:uppercase;
}
.device-section__body{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  font-size:13px;
  color:#e0ecff;
  line-height:1.4;
}

.capability-badge{
  padding:3px 11px;
  border-radius:999px;
  border:1px solid rgba(91,209,255,.28);
  background:linear-gradient(135deg, rgba(20,38,64,.72), rgba(16,28,48,.72));
  font-size:12px;
  letter-spacing:.08em;
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.12);
}

.device-last-result{
  display:flex;
  flex-direction:column;
  gap:8px;
  font-size:13px;
  color:#dbe9ff;
  background:rgba(12,20,34,.78);
  border:1px solid rgba(91,209,255,.18);
  border-radius:12px;
  padding:12px 14px;
  box-shadow:0 10px 20px rgba(6,12,24,.32);
}

.device-last-result__meta{opacity:.75; font-size:11px; letter-spacing:.04em}

.device-empty{
  grid-column:1/-1;
  padding:32px;
  text-align:center;
  border-radius:16px;
  border:1px dashed rgba(91,209,255,.32);
  background:rgba(13,20,32,.7);
  color:#c8d7f2;
}

.collapsible-text{display:flex; flex-direction:column; gap:6px; font-size:13px; line-height:1.55}
.collapsible-text__content{white-space:pre-wrap; word-break:break-word}
.collapsible-text__toggle{
  align-self:flex-start;
  border:none;
  background:none;
  color:var(--accent);
  cursor:pointer;
  font-size:11px;
  padding:0;
  text-decoration:underline;
}
.collapsible-text__toggle:hover{color:#9fe8ff}

.dialog{
  border:none;
  border-radius:18px;
  padding:0;
  background:transparent;
  color:inherit;
}

.dialog::backdrop{background:rgba(7,10,18,.65); backdrop-filter:blur(2px)}

.dialog-panel{
  width:min(420px, calc(100vw - 32px));
  background:linear-gradient(160deg, rgba(24,31,46,.95), rgba(12,17,26,.95));
  border:1px solid rgba(91,209,255,.2);
  border-radius:18px;
  display:flex;
  flex-direction:column;
  max-height:90vh;
}

.dialog-header{padding:20px 24px 12px; border-bottom:1px solid rgba(91,209,255,.12)}
.dialog-header h3{margin:0; font-size:18px}

.dialog-body{padding:18px 24px; display:flex; flex-direction:column; gap:16px; overflow-y:auto}
.dialog-footer{padding:16px 24px 22px; display:flex; justify-content:flex-end; gap:12px; border-top:1px solid rgba(91,209,255,.12)}

.dialog-message{font-size:13px; color:#c8d7f2; line-height:1.6}
.dialog-message.error{color:#ffb3ad}
.dialog-message.success{color:#c9f5db}

.form-row{display:flex; flex-direction:column; gap:6px}
.form-label{font-size:13px; letter-spacing:.05em; color:rgba(200,214,235,.75)}
.form-control{
  border-radius:10px;
  border:1px solid rgba(91,209,255,.2);
  background:rgba(10,15,24,.85);
  color:#e5efff;
  padding:10px 12px;
  font-size:14px;
}
.form-control:focus{outline:none; border-color:rgba(91,209,255,.55); box-shadow:0 0 0 2px rgba(91,209,255,.2)}

/* chat */
.chat-layout{display:grid; grid-template-columns:1.4fr .9fr; gap:16px}
.chat-pane{
  background:var(--panel); border:1px solid var(--border);
  border-radius:12px; display:flex; flex-direction:column; min-height:480px; box-shadow:var(--shadow)
}
.chat-pane-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px;
  border-bottom:1px solid var(--border);
}
.chat-pane-header h2{
  margin:0;
  font-size:16px;
}
.chat-log{flex:1; overflow-y:auto; overflow-x:hidden; padding:12px; display:flex; flex-direction:column; gap:10px}
.msg{max-width:80%; padding:10px 12px; border-radius:12px; line-height:1.5; white-space:pre-wrap}
.msg.compact{font-size:14px; padding:8px 10px}
.msg.user{align-self:flex-end; background:#2d3b57; border:1px solid #3e4b6b}
.msg.system,
.msg.assistant{align-self:flex-start; background:#1f2738; border:1px solid #33405d}
.msg.assistant.thinking{
  position:relative;
  padding:16px 18px;
  border-radius:16px;
  background:linear-gradient(160deg, rgba(44,78,132,.92), rgba(20,36,70,.88));
  border:1px solid rgba(91,209,255,.4);
  box-shadow:0 18px 36px rgba(6,14,32,.55);
  overflow:hidden;
  color:#e6f0ff;
}
.msg.assistant.thinking.pending{opacity:1; font-style:normal;}
.msg.assistant.thinking::before{
  content:"";
  position:absolute;
  inset:-140% -60%;
  background:conic-gradient(from 90deg at 50% 50%, rgba(91,209,255,.1), rgba(22,118,255,.25), rgba(91,209,255,.1));
  animation:thinkingGlow 6s linear infinite;
  opacity:.7;
}
.msg.assistant.thinking::after{
  content:"";
  position:absolute;
  inset:0;
  border-radius:inherit;
  background:radial-gradient(120% 140% at 20% 20%, rgba(91,209,255,.18), transparent 55%);
  pointer-events:none;
  mix-blend-mode:screen;
}
.thinking-header{
  display:flex;
  align-items:flex-start;
  gap:12px;
  margin-bottom:0;
  position:relative;
  z-index:1;
}
.thinking-labels{display:flex; flex-direction:column; gap:4px;}
.thinking-title{font-size:13px; font-weight:600; letter-spacing:.04em; text-transform:none;}
.thinking-sub{font-size:11px; color:rgba(230,233,239,.75); letter-spacing:.02em;}
.thinking-detail{
  font-size:12px;
  line-height:1.7;
  color:rgba(220,230,247,.82);
  letter-spacing:.02em;
}
.thinking-orb{
  width:14px;
  height:14px;
  border-radius:999px;
  background:var(--accent);
  box-shadow:0 0 18px rgba(91,209,255,.8);
  position:relative;
}
.thinking-orb::after{
  content:"";
  position:absolute;
  inset:-5px;
  border-radius:inherit;
  border:2px solid rgba(91,209,255,.6);
  opacity:.9;
  animation:thinkingOrbPulse 2s ease-in-out infinite;
}
.msg.assistant.thinking .msg-time{
  position:relative;
  z-index:1;
  display:block;
  margin-top:14px;
  opacity:.65;
}
.msg.pending{opacity:.78; font-style:italic}
.msg-time{display:block; opacity:.6; font-size:11px; margin-top:4px}
.chat-form{display:flex; gap:8px; padding:10px; border-top:1px solid var(--border)}
.chat-input{
  flex:1; border:1px solid var(--border); border-radius:10px; background:#0f1320;
  color:#fff; padding:10px 12px;
  overflow-y:auto;
  overflow-x:hidden;
}

.sidebar-chat-log,
.sidebar-chat-input,
.chat-log,
.chat-input{
  scrollbar-width:thin;
  scrollbar-color:var(--scrollbar-thumb) var(--scrollbar-track);
}

.sidebar-chat-log::-webkit-scrollbar,
.sidebar-chat-input::-webkit-scrollbar,
.chat-log::-webkit-scrollbar,
.chat-input::-webkit-scrollbar{
  width:10px;
}

.sidebar-chat-log::-webkit-scrollbar-track,
.sidebar-chat-input::-webkit-scrollbar-track,
.chat-log::-webkit-scrollbar-track,
.chat-input::-webkit-scrollbar-track{
  background:var(--scrollbar-track);
  border-radius:999px;
  border:1px solid rgba(44,58,84,.55);
  box-shadow:inset 0 0 0 1px rgba(20,28,44,.65);
}

.sidebar-chat-log::-webkit-scrollbar-thumb,
.sidebar-chat-input::-webkit-scrollbar-thumb,
.chat-log::-webkit-scrollbar-thumb,
.chat-input::-webkit-scrollbar-thumb{
  background:linear-gradient(180deg, rgba(76,118,189,.7), rgba(44,74,128,.75));
  border-radius:999px;
  border:1px solid rgba(124,176,238,.35);
  box-shadow:inset 0 0 6px rgba(12,18,32,.35);
}

.sidebar-chat-log::-webkit-scrollbar-thumb:hover,
.sidebar-chat-input::-webkit-scrollbar-thumb:hover,
.chat-log::-webkit-scrollbar-thumb:hover,
.chat-input::-webkit-scrollbar-thumb:hover{
  background:linear-gradient(180deg, rgba(101,158,226,.78), rgba(54,94,152,.82));
  border-color:rgba(156,204,255,.45);
}

.sidebar-chat-log::-webkit-scrollbar-corner,
.sidebar-chat-input::-webkit-scrollbar-corner,
.chat-log::-webkit-scrollbar-corner,
.chat-input::-webkit-scrollbar-corner{
  background:transparent;
}

.summary-layout{display:flex; justify-content:center}
.summary-panel{
  position:relative;
  width:min(720px, 100%);
  background:linear-gradient(155deg, rgba(24,30,46,.95), rgba(12,17,27,.92));
  border:1px solid rgba(91,209,255,.2);
  border-radius:20px;
  padding:32px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:24px;
  overflow:hidden;
}
.summary-panel::after{
  content:"";
  position:absolute;
  top:-100px; right:-140px;
  width:260px; height:260px;
  background:radial-gradient(circle at center, rgba(91,209,255,.28), transparent 70%);
  pointer-events:none;
}
.summary-panel-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:24px;
  position:relative;
  z-index:1;
}
.summary-heading h2{
  margin:0;
  font-size:26px;
  font-weight:700;
}
.summary-heading p{margin:8px 0 0; font-size:14px; color:var(--muted)}
.summary-actions{display:flex; gap:12px; flex-wrap:wrap}
.summary-actions .btn{min-width:96px}
.summary-box{
  position:relative;
  z-index:1;
  background:rgba(8,12,22,.88);
  border:1px solid rgba(91,209,255,.2);
  border-radius:16px;
  padding:22px 24px;
  min-height:220px;
  color:#dce6f7;
  line-height:1.8;
  font-size:15px;
  white-space:pre-wrap;
  box-shadow:inset 0 0 0 1px rgba(12,36,66,.4);
}

/* footer */
.footer{
  display:flex; gap:10px; align-items:center; justify-content:center; padding:12px; color:#9fb0c9;
  border-top:1px solid var(--border); background:#0d111a
}

@media (max-width: 960px){
  .layout{flex-direction:column;}
  .layout.sidebar-collapsed .sidebar{
    width:auto;
    flex-basis:auto;
    padding:20px;
    transform:none;
    opacity:1;
    border-right:none;
    pointer-events:auto;
    overflow:auto;
  }
  .sidebar{
    width:auto;
    flex:1 1 auto;
    border-right:none;
    border-bottom:1px solid var(--border);
    flex-direction:row;
    flex-wrap:wrap;
    gap:18px;
    align-items:flex-start;
    padding:20px;
    position:static;
    top:auto;
    height:auto;
    max-height:none;
    overflow:visible;
    align-self:stretch;
  }
  .sidebar-toggle{display:none;}
  .sidebar-title{width:100%;}
  .nav-btn{flex:1;}
  .nav-btn span{display:none}
  .sidebar-chat{flex:1 1 100%; order:3;}
  .sidebar-chat-log{min-height:200px; max-height:320px;}
}

@media (max-width: 520px){
  .sidebar-chat-form{gap:10px; padding:10px;}
  .sidebar-chat-input{min-height:56px; padding:12px 14px;}
  .sidebar-chat-action-column{gap:8px;}
  .sidebar-chat-control{font-size:11px; padding:8px 10px;}
  .sidebar-chat-send{width:44px; height:44px;}
}

@media (max-width: 720px){
  .chat-layout{grid-template-columns:1fr;}
  .summary-panel{padding:24px 20px;}
  .summary-panel-header{flex-direction:column; align-items:flex-start;}
  .summary-actions{width:100%; justify-content:flex-start;}
}
.footer .divider{opacity:.4}

@keyframes thinkingOrbPulse{
  0%{transform:scale(.8); opacity:.6;}
  50%{transform:scale(1); opacity:1;}
  100%{transform:scale(.8); opacity:.6;}
}

@keyframes thinkingGlow{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}

/* responsive */
@media (max-width: 860px){
  .chat-layout{grid-template-columns:1fr}
}

:root{
  --bg:#0f1115;
  --panel:#161a22;
  --panel-2:#1b2130;
  --border:#2a3242;
  --text:#e6e9ef;
  --muted:#b8c1cc;
  --primary:#177de5;
  --primary-2:#0f62c7;
  --accent:#5bd1ff;
  --good:#38c172;
  --warn:#ffb020;
  --bad:#ef5350;
  --shadow:0 10px 25px rgba(0,0,0,.35);
  --radius:14px;
  --sidebar-width:495px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Apple Color Emoji','Segoe UI Emoji',sans-serif;
  line-height:1.6;
}

.app{min-height:100svh; display:flex; flex-direction:column}

.content-header{
  display:flex; flex-direction:column; gap:6px;
  margin-bottom:20px;
}
.content-title{margin:0; font-size:26px; font-weight:700}
.content-subtitle{margin:0; font-size:14px; color:var(--muted)}

/* layout */
.layout{
  display:flex;
  min-height:0;
  min-width:0;
  flex:1;
  position:relative;
}

/* sidebar */
.sidebar{
  width:var(--sidebar-width);
  flex:0 0 var(--sidebar-width);
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:28px 20px;
  display:flex;
  flex-direction:column;
  gap:20px;
  min-height:0;
  min-width:0;
  position:sticky;
  top:0;
  align-self:stretch;
  height:100vh;
  height:100svh;
  overflow:auto;
  transition:width .45s ease, padding .45s ease, transform .45s ease, opacity .3s ease, border-color .45s ease;
}
.layout.sidebar-collapsed .sidebar{
  width:0;
  flex-basis:0;
  padding-left:0;
  padding-right:0;
  transform:translateX(-32px);
  opacity:0;
  border-right-color:transparent;
  pointer-events:none;
  overflow:hidden;
}
.layout.sidebar-collapsed .sidebar-chat,
.layout.sidebar-collapsed .sidebar-nav,
.layout.sidebar-collapsed .sidebar-title{
  opacity:0;
  transition:opacity .2s ease;
}
.layout .sidebar-chat,
.layout .sidebar-nav,
.layout .sidebar-title{
  transition:opacity .3s ease .15s;
}

.sidebar-toggle{
  position:absolute;
  top:var(--sidebar-toggle-top, 50%);
  left:calc(var(--sidebar-width) - 16px);
  transform:translate(-50%, -50%);
  width:44px;
  height:92px;
  border-radius:999px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, rgba(34,43,62,.96), rgba(16,22,34,.94));
  color:var(--muted);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:var(--shadow);
  transition:background .25s ease, color .25s ease, box-shadow .25s ease, left .45s ease;
  z-index:30;
}
.sidebar-toggle:hover{
  color:#fff;
  box-shadow:0 18px 32px rgba(10,18,32,.6);
  background:linear-gradient(180deg, rgba(44,56,80,.96), rgba(18,26,40,.94));
}
.sidebar-toggle:active{
  box-shadow:0 12px 24px rgba(8,14,24,.65);
}
.sidebar-toggle:focus-visible{
  outline:2px solid rgba(91,209,255,.7);
  outline-offset:3px;
}
.sidebar-toggle-icon{
  display:flex;
  align-items:center;
  justify-content:center;
  transition:transform .45s ease;
}
.sidebar-toggle-icon svg{width:18px; height:18px; display:block;}
.layout.sidebar-collapsed .sidebar-toggle{
  left:24px;
}
.layout.sidebar-collapsed .sidebar-toggle-icon{
  transform:rotate(180deg);
}
.sidebar-title{
  margin:0; font-size:13px; font-weight:600; color:var(--muted);
  letter-spacing:.04em;
}
.sidebar-nav{
  display:flex;
  gap:12px;
  align-items:stretch;
}
.sr-only{
  position:absolute;
  width:1px;
  height:1px;
  padding:0;
  margin:-1px;
  overflow:hidden;
  clip:rect(0,0,0,0);
  border:0;
}
.sidebar-chat{
  background:linear-gradient(180deg, rgba(32,41,62,.92), rgba(19,25,36,.94));
  border:1px solid rgba(91,209,255,.18);
  border-radius:18px;
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:18px;
  box-shadow:var(--shadow);
  flex:1;
  min-height:0;
  max-height:100%;
  overflow:hidden;
}
.sidebar-chat-header{display:flex; flex-direction:column; gap:8px}
.sidebar-chat-title{
  margin:0;
  font-size:15px;
  font-weight:700;
  letter-spacing:.05em;
  display:flex;
  align-items:center;
  gap:10px;
}
.sidebar-chat-icon{
  width:36px;
  height:36px;
  border-radius:12px;
  background:rgba(91,209,255,.12);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.3);
}
.sidebar-chat-icon svg{width:20px; height:20px}
.sidebar-chat-desc{margin:0; font-size:12px; color:var(--muted); line-height:1.6}
.sidebar-chat-log{
  background:rgba(8,12,22,.88);
  border:1px solid rgba(91,209,255,.14);
  border-radius:14px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
  min-height:0;
  max-height:100%;
  flex:1;
  overflow:auto;
}
.sidebar-chat-form{
  display:flex;
  gap:14px;
  align-items:stretch;
  background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(91,209,255,.08));
  border:1px solid rgba(91,209,255,.22);
  border-radius:16px;
  padding:16px;
  box-shadow:0 14px 34px rgba(7,16,32,.45);
}
.sidebar-chat-action-column{
  display:flex;
  flex-direction:column;
  gap:14px;
  align-items:center;
  justify-content:space-between;
  min-width:0;
  align-self:stretch;
}
.sidebar-chat-utilities{
  display:flex;
  gap:10px;
  justify-content:center;
}
.sidebar-chat-utilities[hidden]{
  display:none;
}
.sidebar-chat-control{
  width:44px;
  height:44px;
  border-radius:14px;
  border:1px solid rgba(91,209,255,.25);
  background:linear-gradient(160deg, rgba(47,123,255,.18), rgba(26,91,255,.12));
  color:var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, background .18s ease;
  padding:0;
}
.sidebar-chat-control:disabled{
  opacity:.55;
  cursor:not-allowed;
  box-shadow:none;
}
.sidebar-chat-control:not(:disabled):hover{
  transform:translateY(-1px);
  box-shadow:0 18px 30px rgba(16,44,102,.4);
  border-color:rgba(91,209,255,.55);
  background:linear-gradient(160deg, rgba(63,139,255,.32), rgba(26,91,255,.18));
}
.sidebar-chat-control:focus-visible{
  outline:2px solid rgba(91,209,255,.75);
  outline-offset:3px;
}
.sidebar-chat-control-icon svg{
  width:18px;
  height:18px;
  display:block;
}
.sidebar-chat-input{
  flex:1;
  width:100%;
  min-height:92px;
  border-radius:16px;
  border:1px solid rgba(86,132,205,.42);
  background:linear-gradient(180deg, #f6f9ff 0%, #e4edff 100%);
  color:#0f1f38;
  padding:16px 18px;
  font-size:14px;
  font-family:inherit;
  line-height:1.65;
  resize:vertical;
  box-shadow:0 10px 28px rgba(15,34,68,.2), inset 0 0 0 1px rgba(255,255,255,.7);
  transition:border-color .18s ease, box-shadow .18s ease;
  caret-color:var(--accent);
}
.sidebar-chat-input:focus{
  outline:none;
  border-color:rgba(74,134,255,.78);
  box-shadow:0 16px 36px rgba(18,40,78,.28), 0 0 0 2px rgba(91,209,255,.32), inset 0 0 0 1px rgba(255,255,255,.9);
}
.sidebar-chat-input::placeholder{
  color:rgba(60,92,148,.8);
}
.sidebar-chat-send{
  flex-shrink:0;
  width:48px;
  height:48px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg, #2f7bff, #1a5bff);
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  cursor:pointer;
  font-family:inherit;
  box-shadow:0 18px 32px rgba(16,44,102,.45);
  transition:transform .18s ease, box-shadow .18s ease, background .18s ease;
  -webkit-appearance:none;
  appearance:none;
}
.sidebar-chat-send:hover{
  transform:translateY(-1px);
  box-shadow:0 24px 40px rgba(16,44,102,.5);
}
.sidebar-chat-send:active{
  transform:translateY(0);
  box-shadow:0 12px 24px rgba(16,44,102,.45);
}
.sidebar-chat-send:focus-visible{
  outline:2px solid rgba(91,209,255,.75);
  outline-offset:3px;
}
.sidebar-chat-send-icon svg{
  width:18px;
  height:18px;
  display:block;
}
.sidebar-chat-log .msg{
  max-width:100%;
  font-size:13px;
  padding:10px 12px;
  border-radius:12px;
  background:rgba(33,45,68,.78);
  border:none;
  align-self:stretch;
}
.sidebar-chat-log .msg.compact .msg-time{font-size:11px}
.sidebar-chat-log .msg.user{
  background:rgba(47,89,164,.75);
  border:1px solid rgba(91,209,255,.35);
}
.sidebar-chat-log .msg.system,
.sidebar-chat-log .msg.assistant{
  background:rgba(32,44,68,.78);
  border:1px solid rgba(91,209,255,.2);
}
.sidebar-chat-log .msg.pending{opacity:.75; font-style:italic;}
.nav-btn{
  display:flex; flex-direction:column; align-items:center; gap:4px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, #1a2130, #141a26);
  color:var(--muted);
  padding:10px 6px; border-radius:12px; cursor:pointer;
  width:100%;
  transition:.15s transform ease, .15s box-shadow ease, .15s color ease, .15s border-color ease;
}
.nav-btn svg{opacity:.9}
.nav-btn span{font-size:11px; letter-spacing:.04em}
.nav-btn:hover{transform:translateY(-1px); box-shadow:var(--shadow); color:#fff; border-color:#3a4660}
.nav-btn.active{color:#fff; border-color:#4a86ff; box-shadow:0 0 0 1px #4a86ff inset}

.sidebar-nav .nav-btn{
  flex:1;
  width:auto;
  min-width:0;
}
.sidebar-nav .nav-btn svg{
  width:18px;
  height:18px;
}

/* main content */
.content{
  flex:1;
  padding:24px;
  display:flex;
  flex-direction:column;
  gap:24px;
  overflow-y:auto;
  background:
    radial-gradient(1200px 700px at 30% -80%, rgba(61,125,255,.18), transparent 60%),
    radial-gradient(1200px 700px at 90% -80%, rgba(40,201,255,.14), transparent 60%);
}

.view{display:none}
.view.active{display:block}
.general-view{
  background:var(--panel-2);
  border-radius:18px;
  padding:28px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:16px;
}
.general-view h2{
  margin:0;
  font-size:24px;
  font-weight:700;
}
.general-view p{
  margin:0;
  color:var(--muted);
  font-size:15px;
  line-height:1.8;
}

/* generic buttons */
.btn{
  appearance:none; border:none; cursor:pointer;
  padding:10px 14px; border-radius:10px;
  background:#2a3446; color:#fff; box-shadow:var(--shadow);
}
.btn.subtle{background:#242b3a; box-shadow:none; border:1px solid var(--border)}
.btn.ghost{background:transparent; border:1px solid #6e84a8}
.btn.primary{background:linear-gradient(180deg, var(--primary), var(--primary-2)); font-weight:700}
.btn.large{font-size:18px; padding:12px 20px}

/* browser */
.browser-info{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:var(--shadow);
  margin-bottom:16px;
}
.browser-info-text{
  margin:0;
  font-size:14px;
  color:var(--muted);
}
.browser-info-text code{
  color:var(--accent);
  font-family:inherit;
}

.no-vnc-surface{
  background:var(--panel-2);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
}

.stage{
  aspect-ratio:16/9;
  width:100%;
  background:#0f1115;
  border-radius:10px;
  border:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  overflow:hidden;
  color:#c1cad7;
}

.stage iframe{
  width:100%;
  height:100%;
  border:0;
  border-radius:8px;
  background:#0a0c10;
}

.stage-fallback{
  margin:0;
  padding:24px;
  color:var(--muted);
  font-size:14px;
  text-align:center;
}

.browser-toolbar{
  display:flex;
  justify-content:flex-end;
  align-items:center;
  gap:8px;
  padding-top:10px;
}

/* IoT dashboard */
.section-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin:8px 0 14px;
  gap:18px;
}
.section-header h2, .section-header h3{margin:0}
.section-title{
  display:flex;
  align-items:center;
  gap:16px;
  flex-wrap:wrap;
}
.section-title > div{display:flex; flex-direction:column; gap:4px}
.section-icon{
  width:44px;
  height:44px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(91,209,255,.14);
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.24);
}
.section-icon svg{width:24px; height:24px}
.section-caption{margin:4px 0 0; font-size:13px; color:var(--muted)}
.section-actions{display:flex; gap:10px; flex-wrap:wrap}
.badge{
  background:#263248; border:1px solid #3a4b6b; color:#cde3ff;
  padding:4px 8px; border-radius:999px; font-size:12px
}

.device-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));
  gap:20px;
  margin-bottom:16px;
}
.device-card{
  position:relative;
  overflow:hidden;
  background:linear-gradient(160deg, rgba(26,33,48,.96), rgba(15,19,30,.94));
  border:1px solid rgba(91,209,255,.18);
  border-radius:16px;
  padding:20px;
  display:flex;
  flex-direction:column;
  gap:20px;
  box-shadow:var(--shadow);
}
.device-card::before{
  content:"";
  position:absolute;
  top:-60px; right:-70px;
  width:200px; height:200px;
  background:radial-gradient(circle at center, rgba(91,209,255,.28), transparent 70%);
  opacity:.8;
  pointer-events:none;
}
.device-card-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  position:relative;
  z-index:1;
}
.device-title{
  display:flex;
  align-items:center;
  gap:14px;
  min-width:0;
}
.device-icon{
  width:48px;
  height:48px;
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(91,209,255,.12);
  color:var(--accent);
  box-shadow:inset 0 0 0 1px rgba(91,209,255,.32);
}
.device-icon svg{width:26px; height:26px}
.device-icon.actuator{
  background:rgba(23,125,229,.14);
  color:var(--primary);
  box-shadow:inset 0 0 0 1px rgba(23,125,229,.3);
}
.device-meta{display:flex; flex-direction:column; gap:4px; min-width:0}
.device-name{
  font-weight:700;
  font-size:17px;
  margin:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.device-type{
  font-size:12px;
  letter-spacing:.08em;
  text-transform:uppercase;
  color:rgba(201,214,233,.75);
}
.device-tools{display:flex; align-items:center; gap:8px}
.icon-btn{
  width:34px;
  height:34px;
  border-radius:10px;
  border:1px solid rgba(115,138,178,.45);
  background:rgba(8,12,20,.65);
  color:#d0d9ea;
  display:grid;
  place-items:center;
  cursor:pointer;
  transition:.15s ease;
}
.icon-btn:hover{
  color:#fff;
  border-color:rgba(91,209,255,.55);
  background:rgba(33,47,72,.85);
}
.icon-btn:focus{outline:none; box-shadow:0 0 0 2px rgba(91,209,255,.3);}
.device-body{
  position:relative;
  z-index:1;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:18px;
  flex-wrap:wrap;
}
.device-stat{
  flex:1;
  min-width:170px;
  background:rgba(9,13,22,.82);
  border:1px solid rgba(91,209,255,.16);
  border-radius:14px;
  padding:16px 18px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.device-stat-label{font-size:12px; color:rgba(200,214,235,.7); letter-spacing:.08em}
.device-reading{font-size:30px; font-weight:700; letter-spacing:.02em}
.device-status-pill{
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 18px;
  border-radius:999px;
  font-size:16px;
  font-weight:600;
  background:rgba(56,193,114,.18);
  color:#c9f5db;
  box-shadow:inset 0 0 0 1px rgba(56,193,114,.32);
}
.device-status-pill.off{
  background:rgba(239,83,80,.16);
  color:#ffd5d2;
  box-shadow:inset 0 0 0 1px rgba(239,83,80,.32);
}
.status-dot{
  width:12px;
  height:12px;
  border-radius:50%;
  display:inline-block;
  margin-right:4px;
  box-shadow:0 0 0 2px rgba(12,20,32,.6);
}
.status-on{background:var(--good)}
.status-off{background:#556070}

.device-controls{
  display:flex;
  align-items:center;
  gap:12px;
  justify-content:flex-end;
  flex:0 0 auto;
}
.device-controls .btn{padding:8px 14px; font-size:13px}

/* toggle */
.switch{
  position:relative;
  width:54px;
  height:30px;
  background:rgba(52,68,96,.75);
  border-radius:999px;
  border:1px solid rgba(91,209,255,.2);
  box-shadow:inset 0 0 0 1px rgba(19,26,38,.9);
  cursor:pointer;
  transition:.25s background ease, .25s border-color ease;
}
.switch::after{
  content:"";
  position:absolute;
  top:3px; left:3px;
  width:24px; height:24px;
  border-radius:50%;
  background:#cfd9ea;
  transition:.25s left ease, .25s background ease;
  box-shadow:0 2px 10px rgba(0,0,0,.35);
}
.switch.on{
  background:linear-gradient(135deg, rgba(56,193,114,.75), rgba(31,142,90,.85));
  border-color:rgba(56,193,114,.45);
}
.switch.on::after{left:27px; background:#fff}

/* chat */
.chat-layout{display:grid; grid-template-columns:1.4fr .9fr; gap:16px}
.chat-pane{
  background:var(--panel); border:1px solid var(--border);
  border-radius:12px; display:flex; flex-direction:column; min-height:480px; box-shadow:var(--shadow)
}
.chat-pane-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px;
  border-bottom:1px solid var(--border);
}
.chat-pane-header h2{
  margin:0;
  font-size:16px;
}
.chat-log{flex:1; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px}
.msg{max-width:80%; padding:10px 12px; border-radius:12px; line-height:1.5; white-space:pre-wrap}
.msg.compact{font-size:14px; padding:8px 10px}
.msg.user{align-self:flex-end; background:#2d3b57; border:1px solid #3e4b6b}
.msg.system,
.msg.assistant{align-self:flex-start; background:#1f2738; border:1px solid #33405d}
.msg.pending{opacity:.78; font-style:italic}
.msg-time{display:block; opacity:.6; font-size:11px; margin-top:4px}
.chat-form{display:flex; gap:8px; padding:10px; border-top:1px solid var(--border)}
.chat-input{
  flex:1; border:1px solid var(--border); border-radius:10px; background:#0f1320;
  color:#fff; padding:10px 12px
}

.summary-layout{display:flex; justify-content:center}
.summary-panel{
  position:relative;
  width:min(720px, 100%);
  background:linear-gradient(155deg, rgba(24,30,46,.95), rgba(12,17,27,.92));
  border:1px solid rgba(91,209,255,.2);
  border-radius:20px;
  padding:32px;
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:24px;
  overflow:hidden;
}
.summary-panel::after{
  content:"";
  position:absolute;
  top:-100px; right:-140px;
  width:260px; height:260px;
  background:radial-gradient(circle at center, rgba(91,209,255,.28), transparent 70%);
  pointer-events:none;
}
.summary-panel-header{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:24px;
  position:relative;
  z-index:1;
}
.summary-heading h2{
  margin:0;
  font-size:26px;
  font-weight:700;
}
.summary-heading p{margin:8px 0 0; font-size:14px; color:var(--muted)}
.summary-actions{display:flex; gap:12px; flex-wrap:wrap}
.summary-actions .btn{min-width:96px}
.summary-box{
  position:relative;
  z-index:1;
  background:rgba(8,12,22,.88);
  border:1px solid rgba(91,209,255,.2);
  border-radius:16px;
  padding:22px 24px;
  min-height:220px;
  color:#dce6f7;
  line-height:1.8;
  font-size:15px;
  white-space:pre-wrap;
  box-shadow:inset 0 0 0 1px rgba(12,36,66,.4);
}

/* footer */
.footer{
  display:flex; gap:10px; align-items:center; justify-content:center; padding:12px; color:#9fb0c9;
  border-top:1px solid var(--border); background:#0d111a
}

@media (max-width: 960px){
  .layout{flex-direction:column;}
  .layout.sidebar-collapsed .sidebar{
    width:auto;
    flex-basis:auto;
    padding:20px;
    transform:none;
    opacity:1;
    border-right:none;
    pointer-events:auto;
    overflow:auto;
  }
  .sidebar{
    width:auto;
    flex:1 1 auto;
    border-right:none;
    border-bottom:1px solid var(--border);
    flex-direction:row;
    flex-wrap:wrap;
    gap:18px;
    align-items:flex-start;
    padding:20px;
    position:static;
    top:auto;
    height:auto;
    max-height:none;
    overflow:visible;
    align-self:stretch;
  }
  .sidebar-toggle{display:none;}
  .sidebar-title{width:100%;}
  .nav-btn{flex:1;}
  .nav-btn span{display:none}
  .sidebar-chat{flex:1 1 100%; order:3;}
  .sidebar-chat-log{min-height:200px; max-height:320px;}
}

@media (max-width: 520px){
  .sidebar-chat-form{gap:10px; padding:10px;}
  .sidebar-chat-input{min-height:56px; padding:12px 14px;}
  .sidebar-chat-action-column{gap:8px;}
  .sidebar-chat-control{font-size:11px; padding:8px 10px;}
  .sidebar-chat-send{width:44px; height:44px;}
}

@media (max-width: 720px){
  .chat-layout{grid-template-columns:1fr;}
  .summary-panel{padding:24px 20px;}
  .summary-panel-header{flex-direction:column; align-items:flex-start;}
  .summary-actions{width:100%; justify-content:flex-start;}
}
.footer .divider{opacity:.4}

/* responsive */
@media (max-width: 860px){
  .chat-layout{grid-template-columns:1fr}
}
